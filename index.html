<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Ultra Nitro Admins — Store</title>
  <link rel="icon" href="LOGO.png">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #ffffff;
      color: #000000;
      margin: 0;
      padding: 20px;
    }

    header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 20px;
    }

    header img {
      width: 60px;
      height: 60px;
    }

    h1 { margin: 0; }

    .login-box, .store-box {
      max-width: 450px;
      margin: auto;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 10px;
      background: #fafafa;
    }

    input {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    button {
      padding: 10px 14px;
      border: none;
      background: #000;
      color: #fff;
      margin-top: 12px;
      border-radius: 6px;
      cursor: pointer;
    }

    .product-card {
      border: 1px solid #ddd;
      padding: 12px;
      border-radius: 10px;
      background: #fff;
      margin-bottom: 15px;
    }

    .product-card img {
      width: 100%;
      border-radius: 6px;
    }

    .history-item {
      border: 1px solid #ccc;
      padding: 10px;
      border-radius: 6px;
      margin-bottom: 10px;
      background: #fff;
    }
  </style>
</head>

<body>

<header>
  <img src="LOGO.png">
  <h1>Ultra Nitro Admins Store</h1>
</header>

<div id="screen"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getDatabase, ref, push, onValue } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyDOlYis-cCQoYZB8G7gCHvy94ehBrGCRTk",
    authDomain: "sibghatullah-bookstore.firebaseapp.com",
    databaseURL: "https://sibghatullah-bookstore-default-rtdb.firebaseio.com",
    projectId: "sibghatullah-bookstore",
    storageBucket: "sibghatullah-bookstore.firebasestorage.app",
    messagingSenderId: "526470929282",
    appId: "1:526470929282:web:95a13ec9bdcdc50f984d9b",
    measurementId: "G-M43L97GRGM"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  const PRODUCTS = [
    { id: "p1", title: "Mastering JavaScript", img: "Java.png", price: 139 },
    { id: "p2", title: "Mastering Python", img: "Python.png", price: 199 },
    { id: "p3", title: "Mastering HTML", img: "Html.png", price: 229 }
  ];

  const screen = document.getElementById("screen");

  let USER = null;

  showLogin();

  function showLogin() {
    screen.innerHTML = `
      <div class="login-box">
        <h2>Login</h2>
        <input id="name" placeholder="Full Name">
        <input id="address" placeholder="Address">
        <input id="phone" placeholder="Phone Number">

        <button id="loginBtn">Continue</button>
      </div>
    `;

    document.getElementById("loginBtn").onclick = () => {
      let name = document.getElementById("name").value.trim();
      let address = document.getElementById("address").value.trim();
      let phone = document.getElementById("phone").value.trim();

      if (!name || !address || !phone) {
        alert("Enter all details");
        return;
      }

      USER = { name, address, phone };
      showStore();
    };
  }

  function showStore() {
    screen.innerHTML = `
      <div class="store-box">
        <h2>Welcome, ${USER.name}</h2>

        <h3>Books</h3>
        <div id="products"></div>

        <h3>Your Order History</h3>
        <div id="history">Loading...</div>
      </div>
    `;

    loadProducts();
    loadHistory();
  }

  function loadProducts() {
    let container = document.getElementById("products");
    container.innerHTML = "";

    PRODUCTS.forEach(p => {
      let card = document.createElement("div");
      card.className = "product-card";

      card.innerHTML = `
        <img src="${p.img}">
        <h3>${p.title}</h3>
        <p>₹${p.price}</p>
        <button onclick="order('${p.id}')">Order Now</button>
      `;

      container.appendChild(card);
    });
  }

  window.order = function(id) {
    let product = PRODUCTS.find(p => p.id === id);

    push(ref(db, "orders"), {
      name: USER.name,
      phone: USER.phone,
      address: USER.address,
      book: product.title,
      price: product.price,
      status: "Pending",
      date: new Date().toLocaleString()
    });

    alert("Order placed!");
  };

  function loadHistory() {
    let historyBox = document.getElementById("history");

    onValue(ref(db, "orders"), snap => {
      let data = snap.val() || {};
      historyBox.innerHTML = "";

      let found = false;

      Object.values(data).forEach(o => {
        if (o.phone === USER.phone) {
          found = true;

          let div = document.createElement("div");
          div.className = "history-item";

          div.innerHTML = `
            <strong>${o.book}</strong> — ₹${o.price}<br>
            ${o.date}<br>
            Status: <b>${o.status}</b>
          `;

          historyBox.appendChild(div);
        }
      });

      if (!found) {
        historyBox.innerHTML = "No orders yet.";
      }
    });
  }
</script>

</body>
</html>
